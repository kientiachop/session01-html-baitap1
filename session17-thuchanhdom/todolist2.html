<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h1>Thông tin học viện</h1>
  <div id="container">
    <div>
      Họ và tên
      <span><input type="text" placeholder="vui lòng nhập tên" id="user" required></span>
    </div>
    <div>
      Email
      <span><input type="email" placeholder="vui lòng nhập email" id="email"></span>
    </div>
    <div>
      Số điện thoại
      <span><input type="tel" placeholder="vui lòng nhập số điện thoại" id="tel" required></span>
    </div>
    <div>
      Quê quán
      <span><input type="text" placeholder="vui lòng nhập địa chỉ quê quán" id="country" required></span>
    </div>
    <div>
      Giới tính
      <span><input type="radio"  id="gender" value="Nam"> Nam  
        <input type="radio"  id="gender" value="Nữ"> Nữ
      </span>
    </div>
  </div>
  <button onclick="addInfo()">Lưu lại</button>
  <div>
  <label for="search">Tìm Kiếm:</label>
  <input type="text" id="search" oninput="searchStudents()">
    <button onclick="search()">search</button>
    <table id="studentTable">
    </table>
  </div>
  <script>
    let students = [];
    let selectedStudentIndex = -1;

    //
    document.getElementById('studentTable').addEventListener('click', function (event) {
        
        if (event.target && (event.target.id === 'ed' || event.target.id === 'de')) {
            event.preventDefault(); 
            selectedStudentIndex = event.target.closest('tr').rowIndex - 1; 
            handleAction(event.target.id);
        }
    });
    function handleAction(action) {
        if (action === 'ed') {
            editStudent();
        } else if (action === 'de') {
            deleteStudent();
        }
    }
    
    function addInfo() {
    // Lấy giá trị từ các trường input
            let username = document.getElementById('user').value;
            let email = document.getElementById('email').value;
            let tel = document.getElementById('tel').value;
            let country = document.getElementById('country').value;
            let gender = document.getElementsById('gender').value;
            
  let student = {username, email, tel, country, gender};
      if (selectedStudentIndex !== -1) {
            // If in edit mode, update the existing student
            students.splice(selectedStudentIndex, 0, student);
            clearInputFields();
        } else {
            
            students.push(student);
            clearInputFields();
        }

        // tạo lại lựa chọn
        selectedStudentIndex = -1;

        
        displayStudents();
    }
    function deleteStudent() {
        if (selectedStudentIndex !== -1) {
           
            students.splice(selectedStudentIndex, 1);

            
            selectedStudentIndex = -1;

           
            displayStudents();
        }
    }
    
    function editStudent() {

        if (selectedStudentIndex !== -1) {
            
            let editedStudent = students[selectedStudentIndex];

            
            document.getElementById('name').value = editedStudent.name;
            document.getElementById('email').value = editedStudent.email;
            document.getElementById('tel').value = editedStudent.phone;
            document.getElementById('address').value = editedStudent.address;
            document.getElementById('gender').value = editedStudent.gender;
          // Change the "Lưu" button to "Cập nhật"
            document.querySelector('button[type="button"][onclick="addInfo()"]').innerText = "Cập nhật";

            // xóa
            students.splice(selectedStudentIndex, 1);
        }
        
    }
     // kiểm tra nếu chọn eidt
        let saveButton = document.querySelector('button[type="button"][onclick="addInfo()"]');
        if (saveButton.innerText === "Cập nhật") {
            // cập nhật lại thông tin
            saveStudent();

            // Reset form
            clearInputFields();
            saveButton.innerText = "Lưu";
        } else {
            // nếu không thì lưu lại
            saveStudent();
        }
    }
    function clearInputFields() {
        // Clear input fields
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('tel').value = '';
        document.getElementById('address').value = '';
        document.getElementById('gender').value = '';
    }
     function searchStudents() {
        
        let searchTerm = document.getElementById('search').value.toLowerCase();

        // lọc ra tên cần tìm
        let filteredStudents = students.filter(student => student.name.toLowerCase().includes(searchTerm));

        
        displayStudents(filteredStudents);

    }

    
    function displayStudents(filteredStudents) {
        

        
        let table = document.getElementById('studentTable');
        table.innerHTML = ''; // tạo bảng sạch

        // tạo bảng
        let headerRow = table.insertRow(0);
        headerRow.innerHTML = '<th>#</th><th>Họ và Tên</th><th>Email</th><th>Số Điện Thoại</th><th>Quê Quán</th><th>Giới Tính</th><th>Hành Động</th>';
  
        // tạo dòng
        for (let i = 0; i < (filteredStudents || students).length; i++) {
            let student = (filteredStudents || students)[i];
            let row = table.insertRow(i + 1);
            row.innerHTML = `<td>${i+1}</td><td>${student.name}</td><td>${student.email}</td><td>${student.phone}</td><td>${student.address}</td><td>${student.gender}</td><td><a href="" id="ed">edit</a><p> </p><a href="" id="de">delete</a></td>`;
        }
        
    }  
  </script>
</body>
</html>
